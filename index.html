<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æ´—è¡£åº—ä¼šå‘˜ç®¡ç†ç³»ç»Ÿ</title>
  <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      background: #f5f5f5;
      color: #333;
    }
    #app {
      max-width: 600px;
      margin: 0 auto;
      min-height: 100vh;
      background: #fff;
    }
    .header {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 20px;
      text-align: center;
    }
    .header h1 {
      font-size: 20px;
      margin-bottom: 10px;
    }
    .nav-tabs {
      display: flex;
      background: #fff;
      border-bottom: 1px solid #eee;
      position: sticky;
      top: 0;
      z-index: 100;
    }
    .nav-tab {
      flex: 1;
      padding: 15px;
      text-align: center;
      cursor: pointer;
      border-bottom: 3px solid transparent;
      font-size: 14px;
      transition: all 0.3s;
    }
    .nav-tab.active {
      color: #667eea;
      border-bottom-color: #667eea;
      font-weight: bold;
    }
    .content {
      padding: 15px;
    }
    .card {
      background: #fff;
      border-radius: 10px;
      padding: 15px;
      margin-bottom: 15px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }
    .card-title {
      font-size: 16px;
      font-weight: bold;
    }
    .btn {
      padding: 8px 16px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-size: 14px;
      transition: all 0.3s;
    }
    .btn-primary {
      background: #667eea;
      color: white;
    }
    .btn-success {
      background: #48bb78;
      color: white;
      font-weight: bold;
      box-shadow: 0 2px 4px rgba(72, 187, 120, 0.3);
    }
    .btn-danger {
      background: #f56565;
      color: white;
      font-weight: bold;
      box-shadow: 0 2px 4px rgba(245, 101, 101, 0.3);
    }
    .btn-outline {
      background: transparent;
      border: 1px solid #667eea;
      color: #667eea;
    }
    .btn-delete {
      background: #f7f7f7;
      border: 1px solid #ddd;
      color: #666;
      font-size: 12px;
    }
    .btn-sm {
      padding: 5px 10px;
      font-size: 12px;
    }
    .form-group {
      margin-bottom: 15px;
    }
    .form-label {
      display: block;
      margin-bottom: 5px;
      font-size: 14px;
      color: #666;
    }
    .form-input {
      width: 100%;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 5px;
      font-size: 14px;
    }
    .form-input:focus {
      outline: none;
      border-color: #667eea;
    }
    .member-item {
      background: #f9f9f9;
      border-radius: 8px;
      padding: 12px;
      margin-bottom: 10px;
    }
    .member-info {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .member-name {
      font-weight: bold;
      font-size: 16px;
    }
    .member-phone {
      color: #666;
      font-size: 14px;
    }
    .member-balance {
      color: #48bb78;
      font-weight: bold;
      font-size: 16px;
    }
    .member-count {
      color: #667eea;
      font-size: 14px;
    }
    .member-actions {
      display: flex;
      gap: 8px;
      margin-top: 10px;
    }
    .stat-card {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border-radius: 10px;
      padding: 20px;
      margin-bottom: 15px;
    }
    .stat-value {
      font-size: 28px;
      font-weight: bold;
      margin-bottom: 5px;
    }
    .stat-label {
      font-size: 14px;
      opacity: 0.9;
    }
    .record-item {
      border-bottom: 1px solid #eee;
      padding: 10px 0;
    }
    .record-item:last-child {
      border-bottom: none;
    }
    .record-type {
      font-weight: bold;
      font-size: 14px;
    }
    .record-type.recharge {
      color: #48bb78;
    }
    .record-type.consume {
      color: #f56565;
    }
    .record-amount {
      font-weight: bold;
    }
    .record-date {
      color: #999;
      font-size: 12px;
    }
    .modal {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0,0,0,0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
    }
    .modal-content {
      background: white;
      border-radius: 10px;
      padding: 20px;
      width: 90%;
      max-width: 400px;
    }
    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
    }
    .modal-title {
      font-size: 18px;
      font-weight: bold;
    }
    .modal-close {
      background: none;
      border: none;
      font-size: 24px;
      cursor: pointer;
      color: #999;
    }
    .modal-footer {
      display: flex;
      gap: 10px;
      margin-top: 20px;
    }
    .empty-state {
      text-align: center;
      padding: 40px 20px;
      color: #999;
    }
    .loading {
      text-align: center;
      padding: 20px;
      color: #999;
    }
    .search-box {
      margin-bottom: 15px;
    }
    .search-input {
      width: 100%;
      padding: 12px;
      border: 1px solid #ddd;
      border-radius: 25px;
      font-size: 14px;
      padding-left: 40px;
    }
    .search-wrapper {
      position: relative;
    }
    .search-icon {
      position: absolute;
      left: 15px;
      top: 50%;
      transform: translateY(-50%);
      color: #999;
    }
  </style>
</head>
<body>
  <div id="app">
    <div class="header">
      <h1>æ´—è¡£åº—ä¼šå‘˜ç®¡ç†ç³»ç»Ÿ</h1>
    </div>
    
    <div class="nav-tabs">
      <div class="nav-tab" :class="{ active: currentTab === 'members' }" @click="currentTab = 'members'">
        ä¼šå‘˜ç®¡ç†
      </div>
      <div class="nav-tab" :class="{ active: currentTab === 'statistics' }" @click="currentTab = 'statistics'">
        æ•°æ®ç»Ÿè®¡
      </div>
    </div>

    <div class="content">
      <div v-if="currentTab === 'members'">
        <div class="search-box">
          <div class="search-wrapper">
            <span class="search-icon">ğŸ”</span>
            <input 
              type="text" 
              class="search-input" 
              v-model="searchKeyword" 
              placeholder="æœç´¢ä¼šå‘˜å§“åæˆ–ç”µè¯"
              @input="searchMembers"
            >
          </div>
        </div>

        <div class="card">
          <div class="card-header">
            <span class="card-title">ä¼šå‘˜åˆ—è¡¨</span>
            <button class="btn btn-primary btn-sm" @click="showAddModal = true">
              + æ·»åŠ ä¼šå‘˜
            </button>
          </div>
          
          <div v-if="loading" class="loading">åŠ è½½ä¸­...</div>
          
          <div v-else-if="filteredMembers.length === 0" class="empty-state">
            æš‚æ— ä¼šå‘˜æ•°æ®
          </div>
          
          <div v-else>
            <div 
              v-for="member in filteredMembers" 
              :key="member.id" 
              class="member-item"
              @click="selectMember(member)"
            >
              <div class="member-info">
                <div>
                  <div class="member-name">{{ member.name }}</div>
                  <div class="member-phone">{{ member.phone }}</div>
                </div>
                <div style="text-align: right;">
                  <div class="member-balance">Â¥{{ member.balance.toFixed(2) }}</div>
                  <div class="member-count">å‰©ä½™æ¬¡æ•°: {{ member.wash_count }}</div>
                </div>
              </div>
              <div class="member-actions">
                <button class="btn btn-success btn-sm" @click.stop="showRechargeModal(member)">
                  å……å€¼
                </button>
                <button class="btn btn-danger btn-sm" @click.stop="showConsumeModal(member)">
                  æ¶ˆè´¹
                </button>
                <button class="btn btn-outline btn-sm" @click.stop="showRecordsModal(member)">
                  è®°å½•
                </button>
                <button class="btn btn-outline btn-sm" @click.stop="showEditModal(member)">
                  ç¼–è¾‘
                </button>
                <button class="btn btn-delete btn-sm" @click.stop="deleteMember(member)">
                  åˆ é™¤
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div v-if="currentTab === 'statistics'">
        <div class="stat-card">
          <div class="stat-value">{{ statistics.total_members || 0 }}</div>
          <div class="stat-label">æ€»ä¼šå‘˜æ•°</div>
        </div>
        
        <div class="stat-card" style="background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);">
          <div class="stat-value">Â¥{{ (statistics.total_balance || 0).toFixed(2) }}</div>
          <div class="stat-label">æ€»ä½™é¢</div>
        </div>
        
        <div class="stat-card" style="background: linear-gradient(135deg, #ed8936 0%, #dd6b20 100%);">
          <div class="stat-value">{{ statistics.total_wash_count || 0 }}</div>
          <div class="stat-label">æ€»å‰©ä½™æ¬¡æ•°</div>
        </div>
        
        <div class="card" style="cursor: pointer;" @click="showAllRechargeRecords()">
          <div class="card-header">
            <span class="card-title">å……å€¼ç»Ÿè®¡</span>
            <span style="font-size: 12px; color: #667eea;">æŸ¥çœ‹å…¨éƒ¨</span>
          </div>
          <div class="record-item">
            <div>å……å€¼è®°å½•æ•°: {{ statistics.total_recharge_records || 0 }}</div>
            <div>å……å€¼æ€»é‡‘é¢: Â¥{{ (statistics.total_recharge_amount || 0).toFixed(2) }}</div>
          </div>
        </div>
        
        <div class="card" style="cursor: pointer;" @click="showAllConsumptionRecords()">
          <div class="card-header">
            <span class="card-title">æ¶ˆè´¹ç»Ÿè®¡</span>
            <span style="font-size: 12px; color: #667eea;">æŸ¥çœ‹å…¨éƒ¨</span>
          </div>
          <div class="record-item">
            <div>æ¶ˆè´¹è®°å½•æ•°: {{ statistics.total_consumption_records || 0 }}</div>
            <div>æ¶ˆè´¹æ€»é‡‘é¢: Â¥{{ (statistics.total_consumption_amount || 0).toFixed(2) }}</div>
          </div>
        </div>
      </div>
    </div>

    <div v-if="showAddModal" class="modal" @click.self="showAddModal = false">
      <div class="modal-content">
        <div class="modal-header">
          <span class="modal-title">æ·»åŠ ä¼šå‘˜</span>
          <button class="modal-close" @click="showAddModal = false">Ã—</button>
        </div>
        <div class="form-group">
          <label class="form-label">å§“å</label>
          <input type="text" class="form-input" v-model="newMember.name" placeholder="è¯·è¾“å…¥å§“å">
        </div>
        <div class="form-group">
          <label class="form-label">ç”µè¯</label>
          <input type="tel" class="form-input" v-model="newMember.phone" placeholder="è¯·è¾“å…¥ç”µè¯">
        </div>
        <div class="modal-footer">
          <button class="btn btn-outline" @click="showAddModal = false">å–æ¶ˆ</button>
          <button class="btn btn-primary" @click="addMember">ç¡®å®š</button>
        </div>
      </div>
    </div>

    <div v-if="showEditModalFlag" class="modal" @click.self="showEditModalFlag = false">
      <div class="modal-content">
        <div class="modal-header">
          <span class="modal-title">ç¼–è¾‘ä¼šå‘˜</span>
          <button class="modal-close" @click="showEditModalFlag = false">Ã—</button>
        </div>
        <div class="form-group">
          <label class="form-label">å§“å</label>
          <input type="text" class="form-input" v-model="editingMember.name" placeholder="è¯·è¾“å…¥å§“å">
        </div>
        <div class="form-group">
          <label class="form-label">ç”µè¯</label>
          <input type="tel" class="form-input" v-model="editingMember.phone" placeholder="è¯·è¾“å…¥ç”µè¯">
        </div>
        <div class="modal-footer">
          <button class="btn btn-outline" @click="showEditModalFlag = false">å–æ¶ˆ</button>
          <button class="btn btn-primary" @click="updateMember">ç¡®å®š</button>
        </div>
      </div>
    </div>

    <div v-if="showRechargeModalFlag" class="modal" @click.self="showRechargeModalFlag = false">
      <div class="modal-content">
        <div class="modal-header">
          <span class="modal-title">å……å€¼</span>
          <button class="modal-close" @click="showRechargeModalFlag = false">Ã—</button>
        </div>
        <div class="form-group">
          <label class="form-label">å……å€¼é‡‘é¢</label>
          <input type="number" class="form-input" v-model="rechargeData.amount" placeholder="è¯·è¾“å…¥å……å€¼é‡‘é¢">
        </div>
        <div class="form-group">
          <label class="form-label">å……å€¼æ¬¡æ•°</label>
          <input type="number" class="form-input" v-model="rechargeData.wash_count" placeholder="è¯·è¾“å…¥å……å€¼æ¬¡æ•°">
        </div>
        <div class="form-group">
          <label class="form-label">å¤‡æ³¨</label>
          <input type="text" class="form-input" v-model="rechargeData.remark" placeholder="è¯·è¾“å…¥å¤‡æ³¨">
        </div>
        <div class="modal-footer">
          <button class="btn btn-outline" @click="showRechargeModalFlag = false">å–æ¶ˆ</button>
          <button class="btn btn-primary" @click="recharge">ç¡®å®š</button>
        </div>
      </div>
    </div>

    <div v-if="showConsumeModalFlag" class="modal" @click.self="showConsumeModalFlag = false">
      <div class="modal-content">
        <div class="modal-header">
          <span class="modal-title">æ¶ˆè´¹</span>
          <button class="modal-close" @click="showConsumeModalFlag = false">Ã—</button>
        </div>
        <div class="form-group">
          <label class="form-label">æ¶ˆè´¹é‡‘é¢</label>
          <input type="number" class="form-input" v-model="consumeData.amount" placeholder="è¯·è¾“å…¥æ¶ˆè´¹é‡‘é¢">
        </div>
        <div class="form-group">
          <label class="form-label">æ¶ˆè´¹æ¬¡æ•°</label>
          <input type="number" class="form-input" v-model="consumeData.wash_count" placeholder="è¯·è¾“å…¥æ¶ˆè´¹æ¬¡æ•°">
        </div>
        <div class="form-group">
          <label class="form-label">å¤‡æ³¨</label>
          <input type="text" class="form-input" v-model="consumeData.remark" placeholder="è¯·è¾“å…¥å¤‡æ³¨">
        </div>
        <div class="modal-footer">
          <button class="btn btn-outline" @click="showConsumeModalFlag = false">å–æ¶ˆ</button>
          <button class="btn btn-danger" @click="consume">ç¡®å®š</button>
        </div>
      </div>
    </div>

    <div v-if="showRecordsModalFlag" class="modal" @click.self="showRecordsModalFlag = false">
      <div class="modal-content" style="max-width: 500px; max-height: 80vh; overflow-y: auto;">
        <div class="modal-header">
          <span class="modal-title">è®°å½•æ˜ç»†</span>
          <button class="modal-close" @click="showRecordsModalFlag = false">Ã—</button>
        </div>
        
        <div style="margin-bottom: 15px;">
          <div class="card-title" style="margin-bottom: 10px;">å……å€¼è®°å½•</div>
          <div v-if="rechargeRecords.length === 0" class="empty-state" style="padding: 20px;">
            æš‚æ— å……å€¼è®°å½•
          </div>
          <div v-else>
            <div v-for="record in rechargeRecords" :key="record.id" class="record-item">
              <div class="record-type recharge">å……å€¼</div>
              <div style="display: flex; justify-content: space-between; margin-top: 5px;">
                <span class="record-amount">+Â¥{{ record.amount.toFixed(2) }}</span>
                <span class="record-date">{{ formatDate(record.created_at) }}</span>
              </div>
              <div v-if="record.wash_count > 0" style="font-size: 12px; color: #666;">
                æ¬¡æ•°: +{{ record.wash_count }}
              </div>
              <div v-if="record.remark" style="font-size: 12px; color: #999;">
                å¤‡æ³¨: {{ record.remark }}
              </div>
            </div>
          </div>
        </div>
        
        <div>
          <div class="card-title" style="margin-bottom: 10px;">æ¶ˆè´¹è®°å½•</div>
          <div v-if="consumptionRecords.length === 0" class="empty-state" style="padding: 20px;">
            æš‚æ— æ¶ˆè´¹è®°å½•
          </div>
          <div v-else>
            <div v-for="record in consumptionRecords" :key="record.id" class="record-item">
              <div class="record-type consume">æ¶ˆè´¹</div>
              <div style="display: flex; justify-content: space-between; margin-top: 5px;">
                <span class="record-amount">-Â¥{{ record.amount.toFixed(2) }}</span>
                <span class="record-date">{{ formatDate(record.created_at) }}</span>
              </div>
              <div v-if="record.wash_count > 0" style="font-size: 12px; color: #666;">
                æ¬¡æ•°: -{{ record.wash_count }}
              </div>
              <div v-if="record.remark" style="font-size: 12px; color: #999;">
                å¤‡æ³¨: {{ record.remark }}
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div v-if="showAllRechargeModal" class="modal" @click.self="showAllRechargeModal = false">
      <div class="modal-content" style="max-width: 500px; max-height: 80vh; overflow-y: auto;">
        <div class="modal-header">
          <span class="modal-title">å…¨éƒ¨å……å€¼è®°å½•</span>
          <button class="modal-close" @click="showAllRechargeModal = false">Ã—</button>
        </div>
        
        <div v-if="allRechargeRecords.length === 0" class="empty-state" style="padding: 20px;">
          æš‚æ— å……å€¼è®°å½•
        </div>
        <div v-else>
          <div v-for="record in allRechargeRecords" :key="record.id" class="record-item">
            <div class="record-type recharge">å……å€¼</div>
            <div style="display: flex; justify-content: space-between; margin-top: 5px;">
              <span class="record-amount">+Â¥{{ record.amount.toFixed(2) }}</span>
              <span class="record-date">{{ formatDate(record.created_at) }}</span>
            </div>
            <div style="font-size: 12px; color: #666;">
              ä¼šå‘˜: {{ record.member_name }} ({{ record.member_phone }})
            </div>
            <div v-if="record.wash_count > 0" style="font-size: 12px; color: #666;">
              æ¬¡æ•°: +{{ record.wash_count }}
            </div>
            <div v-if="record.remark" style="font-size: 12px; color: #999;">
              å¤‡æ³¨: {{ record.remark }}
            </div>
          </div>
        </div>
      </div>
    </div>

    <div v-if="showAllConsumptionModal" class="modal" @click.self="showAllConsumptionModal = false">
      <div class="modal-content" style="max-width: 500px; max-height: 80vh; overflow-y: auto;">
        <div class="modal-header">
          <span class="modal-title">å…¨éƒ¨æ¶ˆè´¹è®°å½•</span>
          <button class="modal-close" @click="showAllConsumptionModal = false">Ã—</button>
        </div>
        
        <div v-if="allConsumptionRecords.length === 0" class="empty-state" style="padding: 20px;">
          æš‚æ— æ¶ˆè´¹è®°å½•
        </div>
        <div v-else>
          <div v-for="record in allConsumptionRecords" :key="record.id" class="record-item">
            <div class="record-type consume">æ¶ˆè´¹</div>
            <div style="display: flex; justify-content: space-between; margin-top: 5px;">
              <span class="record-amount">-Â¥{{ record.amount.toFixed(2) }}</span>
              <span class="record-date">{{ formatDate(record.created_at) }}</span>
            </div>
            <div style="font-size: 12px; color: #666;">
              ä¼šå‘˜: {{ record.member_name }} ({{ record.member_phone }})
            </div>
            <div v-if="record.wash_count > 0" style="font-size: 12px; color: #666;">
              æ¬¡æ•°: -{{ record.wash_count }}
            </div>
            <div v-if="record.remark" style="font-size: 12px; color: #999;">
              å¤‡æ³¨: {{ record.remark }}
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    const { createApp } = Vue;

    // APIåŸºç¡€URLé…ç½®
    const API_BASE_URL = 'http://localhost:3000/api';

    createApp({
      data() {
        return {
          currentTab: 'members',
          members: [],
          statistics: {},
          loading: false,
          searchKeyword: '',
          filteredMembers: [],
          showAddModal: false,
          showEditModalFlag: false,
          showRechargeModalFlag: false,
          showConsumeModalFlag: false,
          showRecordsModalFlag: false,
          showAllRechargeModal: false,
          showAllConsumptionModal: false,
          newMember: { name: '', phone: '' },
          editingMember: { id: null, name: '', phone: '' },
          rechargeData: { amount: '', wash_count: '', remark: '' },
          consumeData: { amount: '', wash_count: '', remark: '' },
          currentMemberId: null,
          rechargeRecords: [],
          consumptionRecords: [],
          allRechargeRecords: [],
          allConsumptionRecords: []
        };
      },
      mounted() {
        this.loadMembers();
        this.loadStatistics();
      },
      methods: {
        async loadMembers() {
          this.loading = true;
          try {
            const response = await fetch(`${API_BASE_URL}/members`);
            this.members = await response.json();
            this.filteredMembers = this.members;
          } catch (error) {
            console.error('åŠ è½½ä¼šå‘˜å¤±è´¥:', error);
            alert('åŠ è½½ä¼šå‘˜å¤±è´¥ï¼Œè¯·ç¡®ä¿åç«¯æœåŠ¡å·²å¯åŠ¨');
          } finally {
            this.loading = false;
          }
        },
        async loadStatistics() {
          try {
            const response = await fetch(`${API_BASE_URL}/statistics`);
            this.statistics = await response.json();
          } catch (error) {
            console.error('åŠ è½½ç»Ÿè®¡æ•°æ®å¤±è´¥:', error);
          }
        },
        searchMembers() {
          if (!this.searchKeyword) {
            this.filteredMembers = this.members;
            return;
          }
          const keyword = this.searchKeyword.toLowerCase();
          this.filteredMembers = this.members.filter(member => 
            member.name.toLowerCase().includes(keyword) || 
            member.phone.includes(keyword)
          );
        },
        async addMember() {
          if (!this.newMember.name || !this.newMember.phone) {
            alert('è¯·å¡«å†™å®Œæ•´ä¿¡æ¯');
            return;
          }
          try {
            const response = await fetch(`${API_BASE_URL}/members`, {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify(this.newMember)
            });
            if (response.ok) {
              this.showAddModal = false;
              this.newMember = { name: '', phone: '' };
              this.loadMembers();
              this.loadStatistics();
              alert('æ·»åŠ æˆåŠŸ');
            } else {
              const error = await response.json();
              if (error.error && error.error.includes('UNIQUE constraint failed')) {
                alert('æ‰‹æœºå·é‡å¤äº†');
              } else {
                alert(error.error || 'æ·»åŠ å¤±è´¥');
              }
            }
          } catch (error) {
            console.error('æ·»åŠ ä¼šå‘˜å¤±è´¥:', error);
            alert('æ·»åŠ å¤±è´¥');
          }
        },
        async updateMember() {
          if (!this.editingMember.name || !this.editingMember.phone) {
            alert('è¯·å¡«å†™å®Œæ•´ä¿¡æ¯');
            return;
          }
          try {
            const response = await fetch(`${API_BASE_URL}/members/${this.editingMember.id}`, {
              method: 'PUT',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({
                name: this.editingMember.name,
                phone: this.editingMember.phone
              })
            });
            if (response.ok) {
              this.showEditModalFlag = false;
              this.loadMembers();
              alert('æ›´æ–°æˆåŠŸ');
            } else {
              alert('æ›´æ–°å¤±è´¥');
            }
          } catch (error) {
            console.error('æ›´æ–°ä¼šå‘˜å¤±è´¥:', error);
            alert('æ›´æ–°å¤±è´¥');
          }
        },
        async deleteMember(member) {
          if (confirm('æ˜¯å¦åˆ é™¤è¯¥ä¼šå‘˜ï¼Ÿ')) {
            try {
              const response = await fetch(`${API_BASE_URL}/members/${member.id}`, {
                method: 'DELETE'
              });
              if (response.ok) {
                this.loadMembers();
                this.loadStatistics();
                alert('åˆ é™¤æˆåŠŸ');
              } else {
                alert('åˆ é™¤å¤±è´¥');
              }
            } catch (error) {
              console.error('åˆ é™¤ä¼šå‘˜å¤±è´¥:', error);
              alert('åˆ é™¤å¤±è´¥');
            }
          }
        },
        showEditModal(member) {
          this.editingMember = { ...member };
          this.showEditModalFlag = true;
        },
        showRechargeModal(member) {
          this.currentMemberId = member.id;
          this.rechargeData = { amount: '', wash_count: '', remark: '' };
          this.showRechargeModalFlag = true;
        },
        showConsumeModal(member) {
          this.currentMemberId = member.id;
          this.consumeData = { amount: '', wash_count: '', remark: '' };
          this.showConsumeModalFlag = true;
        },
        async recharge() {
          try {
            const response = await fetch(`${API_BASE_URL}/members/${this.currentMemberId}/recharge`, {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({
                amount: parseFloat(this.rechargeData.amount) || 0,
                wash_count: parseInt(this.rechargeData.wash_count) || 0,
                remark: this.rechargeData.remark
              })
            });
            if (response.ok) {
              this.showRechargeModalFlag = false;
              this.loadMembers();
              this.loadStatistics();
              alert('å……å€¼æˆåŠŸ');
            } else {
              alert('å……å€¼å¤±è´¥');
            }
          } catch (error) {
            console.error('å……å€¼å¤±è´¥:', error);
            alert('å……å€¼å¤±è´¥');
          }
        },
        async consume() {
          try {
            const response = await fetch(`${API_BASE_URL}/members/${this.currentMemberId}/consume`, {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({
                amount: parseFloat(this.consumeData.amount) || 0,
                wash_count: parseInt(this.consumeData.wash_count) || 0,
                remark: this.consumeData.remark
              })
            });
            if (response.ok) {
              this.showConsumeModalFlag = false;
              this.loadMembers();
              this.loadStatistics();
              alert('æ¶ˆè´¹æˆåŠŸ');
            } else {
              alert('æ¶ˆè´¹å¤±è´¥');
            }
          } catch (error) {
            console.error('æ¶ˆè´¹å¤±è´¥:', error);
            alert('æ¶ˆè´¹å¤±è´¥');
          }
        },
        async showRecordsModal(member) {
          this.currentMemberId = member.id;
          try {
            const [rechargeRes, consumeRes] = await Promise.all([
              fetch(`${API_BASE_URL}/members/${member.id}/recharge-records`),
              fetch(`${API_BASE_URL}/members/${member.id}/consumption-records`)
            ]);
            this.rechargeRecords = await rechargeRes.json();
            this.consumptionRecords = await consumeRes.json();
            this.showRecordsModalFlag = true;
          } catch (error) {
            console.error('åŠ è½½è®°å½•å¤±è´¥:', error);
            alert('åŠ è½½è®°å½•å¤±è´¥');
          }
        },
        async showAllRechargeRecords() {
          try {
            const response = await fetch(`${API_BASE_URL}/recharge-records`);
            this.allRechargeRecords = await response.json();
            this.showAllRechargeModal = true;
          } catch (error) {
            console.error('åŠ è½½å……å€¼è®°å½•å¤±è´¥:', error);
            alert('åŠ è½½å……å€¼è®°å½•å¤±è´¥');
          }
        },
        async showAllConsumptionRecords() {
          try {
            const response = await fetch(`${API_BASE_URL}/consumption-records`);
            this.allConsumptionRecords = await response.json();
            this.showAllConsumptionModal = true;
          } catch (error) {
            console.error('åŠ è½½æ¶ˆè´¹è®°å½•å¤±è´¥:', error);
            alert('åŠ è½½æ¶ˆè´¹è®°å½•å¤±è´¥');
          }
        },
        selectMember(member) {
        },
        formatDate(dateString) {
          const date = new Date(dateString);
          return date.toLocaleString('zh-CN', {
            year: 'numeric',
            month: '2-digit',
            day: '2-digit',
            hour: '2-digit',
            minute: '2-digit'
          });
        }
      }
    }).mount('#app');
  </script>
</body>
</html>